<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Digital Business Card</title>
  <style>
    :root{
      --bg:#f7f7f8;--panel:#ffffff;--ink:#111827;--muted:#6b7280;--brand:#0f62fe;--border:#e5e7eb;--cta:#f3f4f6;--cta-hover:#eef2ff
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Dubai","Cairo",sans-serif;line-height:1.45}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .topbar{background:linear-gradient(#d9d9dd,#c9c9ce);color:#222;text-align:center;padding:10px 14px;border-radius:10px;font-weight:600;letter-spacing:.2px;margin-bottom:18px}
    .card{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:28px;align-items:start;box-shadow:0 8px 24px rgba(0,0,0,.06)}
    @media (max-width:900px){.card{grid-template-columns:1fr}}
    .brand{display:flex;align-items:flex-start;gap:24px}
    .brand img{width:220px;max-width:40vw;height:auto;object-fit:contain}
    .brand-legend{border-left:3px solid var(--border);padding-left:18px}
    .brand-legend .ar{font-size:26px;font-weight:700;margin-bottom:8px}
    .brand-legend .en{font-size:18px;letter-spacing:.2px}
    .content h1{margin:.2rem 0 .6rem;font-size:28px}
    .subtitle{color:var(--muted);margin-top:-4px}
    .address{margin:12px 0 10px;color:var(--ink)}
    .site a{color:var(--brand);text-decoration:none;font-weight:600}
    .site a:hover{text-decoration:underline}
    .actions{margin-top:16px;display:grid;gap:10px}
    .action{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:12px 14px;border:1px solid var(--border);border-radius:10px;text-decoration:none;color:var(--ink);background:var(--cta)}
    .action:hover{background:var(--cta-hover)}
    .action .left{display:flex;align-items:center;gap:12px}
    .chev{width:16px;height:16px;opacity:.5}
    .rtl{direction:rtl;text-align:right}
    .map-embed{margin-top:16px;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .map-embed iframe{width:100%;height:260px;border:0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar rtl" id="nameAr">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ</div>

    <div class="card">
      <!-- LEFT: Logo + bilingual legend -->
      <div class="brand">
        <img id="logo" src="logo.png" alt="Logo" />
        <div class="brand-legend">
          <div class="ar rtl" id="orgAr">ÿßÿ≥ŸÖ ÿßŸÑÿ¨Ÿáÿ©<br/>ÿßÿ≥ŸÖ ÿßŸÑŸÇÿ≥ŸÖ</div>
          <div class="en" id="orgEn"><strong>Your Organization</strong><br/>Your Department</div>
        </div>
      </div>

      <!-- RIGHT: content -->
      <section class="content">
        <h1 id="orgTitle">Your Organization</h1>
        <div class="subtitle" id="jobTitle">ÿßŸÑŸÖÿ≥ŸÖŸâ ÿßŸÑŸàÿ∏ŸäŸÅŸä</div>
        <div class="address rtl" id="addressAr">ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</div>
        <p class="site"><a id="siteLink" href="https://www.example.com" target="_blank" rel="noopener">www.example.com</a></p>

        <div class="actions">
          <a class="action" id="tel1" href="#"><div class="left">üìû <span><strong id="tel1Text">+971 50 000 0000</strong></span></div><span class="chev">‚Ä∫</span></a>
          <a class="action" id="tel2" href="#"><div class="left">‚òéÔ∏è <span><strong id="tel2Text">+971 6 000 0000</strong></span></div><span class="chev">‚Ä∫</span></a>
          <a class="action" id="emailBtn" href="#"><div class="left">‚úâÔ∏è <span><strong id="emailText">firstname.lastname@example.com</strong></span></div><span class="chev">‚Ä∫</span></a>
          <a class="action" id="mapBtn" href="#" target="_blank" rel="noopener"><div class="left">üìç <span><strong>Open Map</strong> <span style="color:var(--muted)">(Google Maps)</span></span></div><span class="chev">‚Ä∫</span></a>
        </div>

        <!-- Embedded map with pinned marker -->
        <div class="map-embed" id="mapEmbed" aria-label="Location map (pinned)"></div>
      </section>
    </div>
  </div>

  <script>
    // --- Helpers ---
    function parseCoordsFromUrl(u){
      try{
        const url = new URL(u);
        const q = url.searchParams.get('query');
        if(q && /^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/.test(q.trim())){
          const [lat, lng] = q.split(',').map(Number); return {lat, lng};
        }
        // Also support maps.google.com/?q=lat,lng
        const q2 = url.searchParams.get('q');
        if(q2 && /^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/.test(q2.trim())){
          const [lat, lng] = q2.split(',').map(Number); return {lat, lng};
        }
      }catch(e){ /* ignore */ }
      return null;
    }

    function buildMapsLink(coords, address){
      if(coords){
        return `https://www.google.com/maps/search/?api=1&query=${coords.lat},${coords.lng}`;
      }
      const q = encodeURIComponent(address||'');
      return `https://www.google.com/maps/search/?api=1&query=${q}`;
    }

    function buildEmbedSrc(coords, address){
      if(coords){
        // Pinned coordinates embed
        const z = 16; // zoom
        return `https://www.google.com/maps?q=${coords.lat},${coords.lng}&z=${z}&output=embed`;
      }
      const q = encodeURIComponent(address||'');
      return `https://www.google.com/maps?q=${q}&output=embed`;
    }

    // --- Main ---
    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    if(!id){ document.body.insertAdjacentHTML('beforeend','<div style="padding:12px">No employee id provided (?id=101).</div>'); }

    const dataUrl = 'employees.json?v=' + Date.now(); // cache-bust

    fetch(dataUrl).then(r=>r.json()).then(list=>{
      const emp = list.find(x => String(x.id) === String(id));
      if(!emp){ document.body.insertAdjacentHTML('beforeend','<div style="padding:12px">Card not found.</div>'); return; }

      // Basic bindings
      document.getElementById('nameAr').textContent = emp.nameAr || emp.nameEn || '‚Äî';
      document.getElementById('jobTitle').textContent = emp.title || '';
      document.getElementById('addressAr').innerHTML = (emp.addressAr||'').replace(/\n/g,'<br/>');

      const siteA = document.getElementById('siteLink');
      if(emp.site){
        siteA.href = emp.site;
        try{ siteA.textContent = new URL(emp.site).host }catch{ siteA.textContent = emp.site }
      }

      const logoEl = document.getElementById('logo');
      if(emp.logoUrl){ logoEl.src = emp.logoUrl; }
      logoEl.onerror = () => { logoEl.style.display = 'none'; };

      const tel1 = document.getElementById('tel1');
      const tel1Text = document.getElementById('tel1Text');
      tel1.href = emp.phone1 ? `tel:${emp.phone1}` : '#';
      tel1Text.textContent = emp.phone1 || '‚Äî';

      const tel2 = document.getElementById('tel2');
      const tel2Text = document.getElementById('tel2Text');
      tel2.href = emp.phone2 ? `tel:${emp.phone2}` : '#';
      tel2Text.textContent = emp.phone2 || '‚Äî';

      const emailBtn = document.getElementById('emailBtn');
      const emailText = document.getElementById('emailText');
      emailBtn.href = emp.email ? `mailto:${emp.email}` : '#';
      emailText.textContent = emp.email || '‚Äî';

      // --- Map: prefer explicit coords if provided ---
      let coords = null;
      if(typeof emp.lat === 'number' && typeof emp.lng === 'number'){
        coords = {lat: emp.lat, lng: emp.lng};
      } else if(emp.mapUrl){
        coords = parseCoordsFromUrl(emp.mapUrl);
      }

      const addressFallback = emp.addressEn || emp.addressAr || '';
      const mapLink = buildMapsLink(coords, addressFallback);
      document.getElementById('mapBtn').href = mapLink;

      const embedSrc = buildEmbedSrc(coords, addressFallback);
      document.getElementById('mapEmbed').innerHTML = `<iframe src="${embedSrc}" loading="lazy" referrerpolicy="no-referrer-when-downgrade" allowfullscreen title="Pinned Map"></iframe>`;
    }).catch(()=>{
      document.body.insertAdjacentHTML('beforeend','<div style="padding:12px">Error loading data.</div>');
    });
  </script>
</body>
</html>

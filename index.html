<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Digital Business Card</title>
<meta name="robots" content="noindex,nofollow,noarchive" />
<style>
  :root{
    --ink:#002b5c;
    --muted:#6b7a90;
    --blue-1:#e6f3ff;
    --blue-2:#b3daff;
    --blue-3:#0073e6;
  }
 
  body{
    margin:0;
    font-family: system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Dubai","Cairo",sans-serif;
    background:url("https://cdnp.flypgs.com/files/Sehirler-long-tail/Sharjah/sharjah-gezi-rehberi.jpg") no-repeat center center fixed;
    background-size:cover;
  }
 
  .wrap{max-width:460px;margin:0 auto;padding:18px}
  .card{
    background:#fff;
    border-radius:18px;
    padding:22px 18px 26px;
    border:1px solid #e5e5e5;
    box-shadow:0 12px 28px rgba(0,0,0,.18);
    min-height:200px;
    position:relative; /* for top-right vCard button */
  }

  /* vCard button (top-right) */
  .vcard-btn{
    position:absolute; top:10px; right:10px;
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 10px; border-radius:10px;
    background:#ffffff; border:1px solid var(--blue-2);
    font-weight:700; color:var(--ink); cursor:pointer;
    box-shadow:0 3px 10px rgba(0,0,0,.08);
    transition:transform .12s, background .15s, box-shadow .15s;
    user-select:none;
  }
  .vcard-btn:hover{ background:#f7fbff; transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.12); }
  .vcard-icon{ display:inline-block; width:18px; height:18px; line-height:0; }

  /* Logo – square, flat (no shadow) */
  .logo-wrap{width:170px;height:170px;margin:0 auto 10px;display:grid;place-items:center}
  .logo{width:170px;height:170px;border-radius:0;overflow:hidden}
  .logo img{width:100%;height:100%;object-fit:contain;display:block;background:transparent}
 
  .name{ text-align:center; font-size:30px; font-weight:900; margin:10px 8px 6px; color:var(--ink); }
  .designation{ text-align:center; font-weight:700; color:#00509e; margin-bottom:12px }
 
  .dash{margin:8px auto 14px; width:100%; height:1px; background:#eee}
 
  /* Buttons */
  .list{display:grid; gap:12px}
  .btn{
    display:flex; align-items:center; gap:12px;
    padding:12px 14px;
    border-radius:12px;
    background:var(--blue-1);
    border:1px solid var(--blue-2);
    text-decoration:none;
    color:var(--ink);
    transition:background .15s, transform .12s;
  }
  .btn:hover{ background:#d4ebff; transform:translateY(-1px); }
 
  .ico{
    width:36px;height:36px;display:grid;place-items:center;flex-shrink:0;
    background:#fff;border:1px solid var(--blue-2);border-radius:10px;
    font-size:18px;line-height:1;
  }
 
  .meta{flex:1;display:flex;flex-direction:column}
  .meta .lbl{font-size:13px;font-weight:700;color:#0059b3}
  .meta .val{font-size:16px;font-weight:800;color:var(--ink)}
 
  /* Direction-aware flow */
  [dir="rtl"] .btn{flex-direction:row-reverse}
  [dir="rtl"] .meta{text-align:right}
  [dir="ltr"] .meta{text-align:left}
 
  .note{margin-top:14px;text-align:center;font-size:12px;color:#777}
 
  /* Error message */
  .error{
    text-align:center; padding:30px 12px; color:#b00020; font-weight:800;
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <!-- Save vCard button (top-right corner) -->
      <button type="button" class="vcard-btn" id="btnVCard" title="Download vCard" aria-label="Download vCard">
        <span class="vcard-icon" aria-hidden="true">
          <!-- Inline SVG: contact card + download arrow -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="4.5" width="18" height="13" rx="2.5" stroke="currentColor" stroke-width="1.6"/>
            <circle cx="9" cy="10" r="2.5" stroke="currentColor" stroke-width="1.6"/>
            <path d="M4.5 16.5c1.2-2.2 3.7-3.5 6.2-3.5s5 1.3 6.2 3.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M12 21v-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M9.8 18.8 12 21l2.2-2.2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span id="vcardLbl">vCard</span>
      </button>

      <!-- Fixed logo file -->
      <div class="logo-wrap">
        <div class="logo"><img src="Logo.png" alt="Logo"></div>
      </div>
 
      <!-- Name / Title -->
      <div class="name" id="name">اسمك هنا</div>
      <div class="designation" id="designation">مسمّاك الوظيفي</div>
      <div class="dash"></div>
 
      <!-- Contact Buttons -->
      <div class="list">
        <a class="btn" id="btnPhone" href="#">
          <div class="ico">📞</div>
          <div class="meta">
            <div class="lbl" id="lblPhone">الهاتف</div>
            <div class="val" id="phoneText">+971 XX XXX XXXX</div>
          </div>
        </a>
 
        <a class="btn" id="btnSite" href="#" target="_blank" rel="noopener">
          <div class="ico">🌐</div>
          <div class="meta">
            <div class="lbl" id="lblSite">الموقع</div>
            <div class="val" id="siteText">example.com</div>
          </div>
        </a>
 
        <a class="btn" id="btnEmail" href="#">
          <div class="ico">✉️</div>
          <div class="meta">
            <div class="lbl" id="lblEmail">البريد الإلكتروني</div>
            <div class="val" id="emailText">info@example.com</div>
          </div>
        </a>
 
        <a class="btn" id="btnMap" href="https://maps.app.goo.gl/ZifwVaEtYV7Ynay79" target="_blank" rel="noopener">
          <div class="ico">📍</div>
          <div class="meta">
            <div class="val" id="lblOpenMap">افتح الخريطة</div>
          </div>
        </a>
      </div>
 
      <div class="note" id="note">اضغط على أي صف لاتخاذ إجراء (اتصال / زيارة / بريد / خريطة)</div>
    </div>
  </div>
 
<script>
  // --- Params ---
  const qs   = new URLSearchParams(location.search);
  const lang = qs.get('lang') === 'en' ? 'en' : 'ar';   // default Arabic
  const id   = qs.get('id') || "";                      // ONLY ?id= (GUID ya Emp1)
 
  // --- Helpers ---
  const $ = (id)=>document.getElementById(id);
  const setText = (id,val)=>{ const el=$(id); if(el) el.textContent = val || '—'; };
 
  function showError(msg){
    $('card').innerHTML = `<div class="error">${msg}</div>`;
  }
 
  // Always load from employees/ folder
  function buildEmployeesPath(id){
    if(!id) return null;
    const hasJson = /\.json$/i.test(id);
    return `employees/${hasJson ? id : (id + '.json')}`;
  }
 
  function localizeLabels(){
    if(lang === 'en'){
      document.documentElement.lang = 'en';
      document.documentElement.dir  = 'ltr';
      setText('lblPhone','Phone');
      setText('lblSite','Website');
      setText('lblEmail','Email');
      setText('lblOpenMap','Open Map');
      setText('note','Tap any row to take action (Call / Visit / Email / Map)');
      // Tooltip stays fixed in English
      const vBtn = $('btnVCard'); if(vBtn) vBtn.title = 'Download vCard';
    }else{
      document.documentElement.lang = 'ar';
      document.documentElement.dir  = 'rtl';
      setText('lblPhone','الهاتف');
      setText('lblSite','الموقع');
      setText('lblEmail','البريد الإلكتروني');
      setText('lblOpenMap','افتح الخريطة');
      setText('note','اضغط على أي صف لاتخاذ إجراء (اتصال / زيارة / بريد / خريطة)');
      // Tooltip stays fixed in English
      const vBtn = $('btnVCard'); if(vBtn) vBtn.title = 'Download vCard';
    }
  }
 
  function setSiteLink(el, href){
    if(!href){ el.removeAttribute('href'); el.href='#'; $('siteText').textContent='—'; return; }
    try{ const u = new URL(href); el.href = href; $('siteText').textContent = u.host; }
    catch{ el.href = href; $('siteText').textContent = href; }
  }

  // --- vCard helpers (no "emp" names used) ---
  function vEsc(s){
    return String(s||'').replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/,/g,'\\,').replace(/;/g,'\\;');
  }
  function bestName(data){
    return data.name || data.nameEn || data.nameAr || 'Contact';
  }
  function safeFile(s){
    return String(s||'Contact').replace(/[<>:"/\\|?*\u0000-\u001F]/g,'').trim() || 'Contact';
  }
  function buildVCard(data){
    const fn   = data.nameEn || data.name || data.nameAr || '';
    const org  = data.company || '';
    const titl = data.titleEn || data.title || data.titleAr || '';
    const tel  = data.phone1 || data.phone || data.mobile || '';
    const mail = data.email || '';
    const url  = data.site || data.website || '';

    // Split into N: Last;First;Middle;;
    let last='', first='', middle='';
    if(fn){
      const parts = fn.trim().split(/\s+/);
      if(parts.length===1){ first = parts[0]; }
      else if(parts.length===2){ first=parts[0]; last=parts[1]; }
      else { first=parts[0]; last=parts[parts.length-1]; middle=parts.slice(1,-1).join(' '); }
    }

    return [
      'BEGIN:VCARD',
      'VERSION:3.0',
      `FN:${vEsc(fn || bestName(data))}`,
      `N:${vEsc(last)};${vEsc(first)};${vEsc(middle)};;`,
      titl ? `TITLE:${vEsc(titl)}` : '',
      org  ? `ORG:${vEsc(org)}` : '',
      tel  ? `TEL;TYPE=CELL,VOICE:${vEsc(tel)}` : '',
      mail ? `EMAIL;TYPE=INTERNET:${vEsc(mail)}` : '',
      url  ? `URL:${vEsc(url)}` : '',
      'END:VCARD'
    ].filter(Boolean).join('\r\n');
  }
  function downloadVCard(data){
    const vcf = buildVCard(data);
    const blob = new Blob([vcf], {type:'text/vcard;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = safeFile(bestName(data)) + '.vcf';
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
  }
 
  async function fetchJSON(path){
    const r = await fetch(path, { cache:'no-store' });
    if(!r.ok) throw new Error('Not found');
    return r.json();
  }
 
  function bind(data){
    const name  = data.nameAr || data.name || 'اسمك هنا';
    const title = data.titleAr || data.title || 'مسمّاك الوظيفي';
    const phone = data.phone1 || data.phone || data.mobile || '+971 XX XXX XXXX';
    const site  = data.site || data.website || '#';
    const email = data.email || 'info@example.com';
 
    setText('name', name);
    setText('designation', title);
    setText('phoneText', phone);
    setText('emailText', email);
 
    $('btnPhone').href = phone ? `tel:${phone}` : '#';
    $('btnEmail').href = email ? `mailto:${email}` : '#';
    setSiteLink($('btnSite'), site);

    // enable vCard using current data
    const vBtn = $('btnVCard');
    if(vBtn){
      vBtn.disabled = false;
      vBtn.onclick = ()=> downloadVCard(data);
    }
  }
 
  (async function init(){
    localizeLabels();
 
    if(!id){
      showError(lang === 'en' ? 'Invalid or missing ID' : 'المعرّف مفقود أو غير صالح');
      return;
    }
 
    const path = buildEmployeesPath(id);
    try{
      const data = await fetchJSON(path);
      bind(data);
    }catch{
      showError(lang === 'en' ? 'Invalid or missing ID' : 'المعرّف مفقود أو غير صالح');
    }
  })();
</script>
</body>
</html>
